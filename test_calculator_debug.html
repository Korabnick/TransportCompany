<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Тест калькулятора</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdn.jsdelivr.net/npm/remixicon@3.5.0/fonts/remixicon.css" rel="stylesheet">
</head>
<body class="bg-gray-100">
    <div class="container mx-auto p-6 max-w-4xl">
        <h1 class="text-2xl font-bold mb-6">Тест калькулятора</h1>
        
        <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
            <!-- Шаг 1 -->
            <div id="step1" class="space-y-4 border-r border-gray-200 pr-6">
                <h3 class="font-bold text-gray-800 mb-4">Шаг 1: Маршрут и время</h3>
                <div>
                    <label class="block text-sm text-gray-600 mb-1">Откуда</label>
                    <input id="fromAddress" type="text" placeholder="Откуда" class="w-full px-4 py-2 border border-gray-200 rounded">
                </div>
                <div>
                    <label class="block text-sm text-gray-600 mb-1">Куда</label>
                    <input id="toAddress" type="text" placeholder="Куда" class="w-full px-4 py-2 border border-gray-200 rounded">
                </div>
                <div>
                    <label class="block text-sm text-gray-600 mb-1">Срочная подача</label>
                    <input id="urgentPickup" type="checkbox" class="w-4 h-4">
                    <label for="urgentPickup" class="ml-2 text-sm">+30% к стоимости</label>
                </div>
                <div>
                    <label class="block text-sm text-gray-600 mb-1">Длительность</label>
                    <select id="durationSelect" class="w-full px-4 py-2 border border-gray-200 rounded">
                        <option value="1">1 час</option>
                        <option value="2">2 часа</option>
                        <option value="3">3 часа</option>
                    </select>
                </div>
                
                <!-- Результаты расчета -->
                <div id="step1Results" class="hidden space-y-3 p-4 bg-gray-50 rounded-lg border">
                    <div class="flex justify-between items-center">
                        <span class="text-sm text-gray-600">Расстояние:</span>
                        <span id="step1Distance" class="font-semibold">0 км</span>
                    </div>
                    <div class="flex justify-between items-center">
                        <span class="text-sm text-gray-600">Стоимость:</span>
                        <span id="step1Price" class="font-bold text-lg text-orange-600">0 ₽</span>
                    </div>
                </div>
            </div>
            
            <!-- Новости -->
            <div id="newsCarousel" class="md:col-span-2 space-y-4 px-6">
                <h3 class="font-bold text-gray-800 mb-4">Новости компании</h3>
                <div class="bg-white p-6 rounded-lg">
                    <p>Здесь будут новости</p>
                </div>
            </div>
            
            <!-- Шаг 2 -->
            <div id="step2" class="hidden space-y-4 border-r border-gray-200 px-6">
                <h3 class="font-bold text-gray-800 mb-4">Шаг 2: Выбор машины</h3>
                <div class="bg-white p-6 rounded-lg">
                    <p>Здесь будет выбор транспорта</p>
                </div>
            </div>
            
            <!-- Шаг 3 -->
            <div id="step3" class="hidden space-y-4 pl-6">
                <h3 class="font-bold text-gray-800 mb-4">Шаг 3: Оформить заказ</h3>
                <div class="space-y-3">
                    <div class="flex justify-between text-sm items-center">
                        <span class="text-gray-600 font-medium">Стоимость маршрута</span>
                        <span id="routeCost" class="text-gray-800 font-semibold">0 ₽</span>
                    </div>
                    <div class="flex justify-between text-sm items-center">
                        <span class="text-gray-600 font-medium">Стоимость транспорта</span>
                        <span id="vehicleCost" class="text-gray-800 font-semibold">0 ₽</span>
                    </div>
                    <div class="flex justify-between text-sm items-center">
                        <span class="text-gray-600 font-medium">Стоимость грузчиков</span>
                        <span id="loadersCost" class="text-gray-800 font-semibold">0 ₽</span>
                    </div>
                    <div class="flex justify-between font-bold mt-4 pt-2 border-t-2 border-orange-500">
                        <span class="text-gray-800">Итого:</span>
                        <span id="totalCost" class="text-orange-600">0 ₽</span>
                    </div>
                </div>
            </div>
        </div>
        
        <div class="mt-6 p-4 bg-white rounded-lg">
            <h4 class="font-bold mb-2">Отладочная информация:</h4>
            <div id="debugInfo" class="text-sm text-gray-600"></div>
        </div>
    </div>

    <script>
        // Простая версия калькулятора для тестирования
        class SimpleCalculator {
            constructor() {
                this.calculationData = {
                    step1: {},
                    step2: {},
                    step3: {}
                };
                this.init();
            }
            
            init() {
                this.bindEvents();
            }
            
            bindEvents() {
                const fromInput = document.getElementById('fromAddress');
                const toInput = document.getElementById('toAddress');
                const urgentCheckbox = document.getElementById('urgentPickup');
                const durationSelect = document.getElementById('durationSelect');
                
                [fromInput, toInput].forEach(input => {
                    input.addEventListener('input', () => {
                        this.checkStepVisibility();
                        this.calculateStep1();
                    });
                });
                
                urgentCheckbox.addEventListener('change', () => {
                    this.recalculateStep1Cost();
                });
                
                durationSelect.addEventListener('change', () => {
                    this.recalculateStep1Cost();
                });
            }
            
            checkStepVisibility() {
                const fromAddress = document.getElementById('fromAddress')?.value || '';
                const toAddress = document.getElementById('toAddress')?.value || '';
                const newsCarousel = document.getElementById('newsCarousel');
                const step2 = document.getElementById('step2');
                const step3 = document.getElementById('step3');
                
                console.log('checkStepVisibility called with:', { fromAddress, toAddress });
                
                if (fromAddress.trim() !== '' && toAddress.trim() !== '') {
                    console.log('Both addresses filled, showing step 2');
                    newsCarousel.classList.add('hidden');
                    step2.classList.remove('hidden');
                    step2.classList.add('md:col-span-1');
                    
                    // Шаг 3 показываем только когда есть результаты расчета
                    const step1Results = document.getElementById('step1Results');
                    if (step1Results && !step1Results.classList.contains('hidden')) {
                        console.log('Step1 results visible, showing step 3');
                        step3.classList.remove('hidden');
                        step3.classList.add('md:col-span-1');
                    } else {
                        console.log('Step1 results not visible yet');
                    }
                } else {
                    console.log('Addresses not filled, showing news carousel');
                    newsCarousel.classList.remove('hidden');
                    step2.classList.add('hidden');
                    step3.classList.add('hidden');
                    step2.classList.remove('md:col-span-1');
                    step3.classList.remove('md:col-span-1');
                }
            }
            
            calculateStep1() {
                const fromAddress = document.getElementById('fromAddress')?.value || '';
                const toAddress = document.getElementById('toAddress')?.value || '';
                const durationHours = parseInt(document.getElementById('durationSelect')?.value) || 1;
                const urgentPickup = document.getElementById('urgentPickup')?.checked || false;
                
                if (!fromAddress || !toAddress) {
                    return;
                }
                
                console.log('calculateStep1 called with:', { fromAddress, toAddress, durationHours, urgentPickup });
                
                // Простая логика расчета расстояния
                const distance = this.estimateDistance(fromAddress, toAddress);
                const totalCost = this.calculateTotalCost(distance, durationHours, urgentPickup);
                
                const routeData = {
                    distance: distance,
                    duration: durationHours * 60,
                    from_address: fromAddress,
                    to_address: toAddress,
                    duration_hours: durationHours,
                    urgent_pickup: urgentPickup,
                    total: totalCost
                };
                
                this.calculationData.step1 = routeData;
                this.updateStep1Display(routeData);
                this.updateRouteCostDisplay();
                
                console.log('Step1 calculation completed:', routeData);
            }
            
            estimateDistance(fromAddress, toAddress) {
                // Простая логика для демонстрации
                const fromLower = fromAddress.toLowerCase();
                const toLower = toAddress.toLowerCase();
                
                if ((fromLower.includes('спб') || fromLower.includes('санкт-петербург')) &&
                    (toLower.includes('спб') || toLower.includes('санкт-петербург'))) {
                    return 15.0;
                }
                
                if (fromLower.includes('область') || toLower.includes('область')) {
                    return 45.0;
                }
                
                return 30.0;
            }
            
            calculateTotalCost(distance, durationHours, urgentPickup) {
                const baseCostPerKm = 10;
                const distanceCost = distance * baseCostPerKm;
                
                let urgentMultiplier = 1;
                if (urgentPickup) {
                    urgentMultiplier = 1.3;
                }
                
                const totalCost = Math.round(distanceCost * urgentMultiplier);
                
                console.log('Step 1 Calculation:', {
                    distance,
                    distanceCost,
                    urgentPickup,
                    urgentMultiplier,
                    totalCost
                });
                
                return totalCost;
            }
            
            recalculateStep1Cost() {
                if (!this.calculationData.step1 || !this.calculationData.step1.distance) {
                    return;
                }
                
                const distance = this.calculationData.step1.distance;
                const durationHours = parseInt(document.getElementById('durationSelect')?.value) || 1;
                const urgentPickup = document.getElementById('urgentPickup')?.checked || false;
                
                const newTotal = this.calculateTotalCost(distance, durationHours, urgentPickup);
                
                this.calculationData.step1.total = newTotal;
                this.updateStep1Display(this.calculationData.step1);
                this.updateRouteCostDisplay();
            }
            
            updateStep1Display(data) {
                const priceElement = document.getElementById('step1Price');
                const distanceElement = document.getElementById('step1Distance');
                const resultsBlock = document.getElementById('step1Results');
                
                if (priceElement) {
                    priceElement.textContent = `${Math.round(data.total)} ₽`;
                }
                
                if (distanceElement) {
                    distanceElement.textContent = `${data.distance} км`;
                }
                
                if (resultsBlock) {
                    resultsBlock.classList.remove('hidden');
                }
                
                console.log('Step1 display updated:', data);
            }
            
            updateRouteCostDisplay() {
                if (this.calculationData.step1 && this.calculationData.step1.total) {
                    const routeCostElement = document.getElementById('routeCost');
                    if (routeCostElement) {
                        routeCostElement.textContent = `${Math.round(this.calculationData.step1.total)} ₽`;
                        console.log('Route cost updated:', this.calculationData.step1.total);
                    }
                }
                
                this.checkStepVisibility();
            }
        }
        
        // Инициализация при загрузке страницы
        document.addEventListener('DOMContentLoaded', function() {
            console.log('DOMContentLoaded event fired');
            window.calculator = new SimpleCalculator();
            console.log('SimpleCalculator instance created:', window.calculator);
        });
    </script>
</body>
</html> 