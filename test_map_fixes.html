<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–¢–µ—Å—Ç –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–π –∫–∞—Ä—Ç—ã</title>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
        }
        .test-section {
            margin: 20px 0;
            padding: 15px;
            border: 1px solid #ccc;
            border-radius: 5px;
        }
        .input-group {
            margin: 10px 0;
        }
        input {
            padding: 8px;
            margin-right: 10px;
            border: 1px solid #ccc;
            border-radius: 3px;
        }
        button {
            padding: 8px 12px;
            background: #007bff;
            color: white;
            border: none;
            border-radius: 3px;
            cursor: pointer;
        }
        button:hover {
            background: #0056b3;
        }
        .map-open-btn {
            background: #28a745;
        }
        .map-open-btn:hover {
            background: #1e7e34;
        }
        #mapPopup {
            position: fixed;
            background: white;
            border: 1px solid #ccc;
            border-radius: 5px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
            z-index: 1000;
            width: 500px;
            height: 500px;
            display: none;
        }
        #mapPopup.hidden {
            display: none;
        }
        .popup-header {
            padding: 10px;
            border-bottom: 1px solid #eee;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        .popup-content {
            padding: 10px;
            height: 400px;
        }
        #mapContainer {
            width: 100%;
            height: 100%;
        }
        .popup-footer {
            padding: 10px;
            border-top: 1px solid #eee;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        .close-btn {
            background: #dc3545;
            color: white;
            border: none;
            padding: 5px 10px;
            border-radius: 3px;
            cursor: pointer;
        }
        .close-btn:hover {
            background: #c82333;
        }
        .status {
            margin-top: 10px;
            padding: 10px;
            background: #f8f9fa;
            border-radius: 3px;
        }
    </style>
</head>
<body>
    <h1>–¢–µ—Å—Ç –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–π –∫–∞—Ä—Ç—ã</h1>
    
    <div class="test-section">
        <h2>–ü—Ä–æ–±–ª–µ–º–∞ 1: –ó–∞–∫—Ä—ã—Ç–∏–µ –∫–∞—Ä—Ç—ã –ø—Ä–∏ –ª—é–±–æ–º –∫–ª–∏–∫–µ</h2>
        <p>–¢–µ–ø–µ—Ä—å –∫–∞—Ä—Ç–∞ –¥–æ–ª–∂–Ω–∞ –∑–∞–∫—Ä—ã–≤–∞—Ç—å—Å—è —Ç–æ–ª—å–∫–æ –ø—Ä–∏ –∫–ª–∏–∫–µ –≤–Ω–µ popup, –∞ –Ω–µ –ø—Ä–∏ –ª—é–±–æ–º –∫–ª–∏–∫–µ –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–µ.</p>
        
        <div class="input-group">
            <input type="text" id="testInput1" placeholder="–ê–¥—Ä–µ—Å 1" readonly>
            <button class="map-open-btn" data-input-id="testInput1">üó∫Ô∏è –ö–∞—Ä—Ç–∞</button>
        </div>
        
        <div class="input-group">
            <input type="text" id="testInput2" placeholder="–ê–¥—Ä–µ—Å 2" readonly>
            <button class="map-open-btn" data-input-id="testInput2">üó∫Ô∏è –ö–∞—Ä—Ç–∞</button>
        </div>
        
        <button onclick="testClick()">–¢–µ—Å—Ç –∫–ª–∏–∫–∞ (–Ω–µ –¥–æ–ª–∂–µ–Ω –∑–∞–∫—Ä—ã–≤–∞—Ç—å –∫–∞—Ä—Ç—É)</button>
        <button onclick="testClickOutside()">–¢–µ—Å—Ç –∫–ª–∏–∫–∞ –≤–Ω–µ –∫–∞—Ä—Ç—ã (–¥–æ–ª–∂–µ–Ω –∑–∞–∫—Ä—ã–≤–∞—Ç—å)</button>
    </div>
    
    <div class="test-section">
        <h2>–ü—Ä–æ–±–ª–µ–º–∞ 2: –ü–æ–≤—Ç–æ—Ä–Ω–∞—è –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –∫–∞—Ä—Ç—ã</h2>
        <p>–¢–µ–ø–µ—Ä—å –∫–∞—Ä—Ç–∞ –¥–æ–ª–∂–Ω–∞ –ø—Ä–∞–≤–∏–ª—å–Ω–æ —É–Ω–∏—á—Ç–æ–∂–∞—Ç—å—Å—è –ø—Ä–∏ –∑–∞–∫—Ä—ã—Ç–∏–∏ –∏ –Ω–µ –≤—ã–∑—ã–≤–∞—Ç—å –æ—à–∏–±–æ–∫ –ø—Ä–∏ –ø–æ–≤—Ç–æ—Ä–Ω–æ–º –æ—Ç–∫—Ä—ã—Ç–∏–∏.</p>
        
        <button onclick="testMultipleOpens()">–¢–µ—Å—Ç –º–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω–æ–≥–æ –æ—Ç–∫—Ä—ã—Ç–∏—è/–∑–∞–∫—Ä—ã—Ç–∏—è</button>
        <button onclick="checkConsole()">–ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∫–æ–Ω—Å–æ–ª—å –Ω–∞ –æ—à–∏–±–∫–∏</button>
    </div>
    
    <div class="status" id="status">
        –°—Ç–∞—Ç—É—Å: –ì–æ—Ç–æ–≤ –∫ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—é
    </div>
    
    <!-- Map Popup -->
    <div id="mapPopup" class="hidden">
        <div class="popup-header">
            <h3>–í—ã–±–æ—Ä –∞–¥—Ä–µ—Å–∞ –Ω–∞ –∫–∞—Ä—Ç–µ</h3>
            <button id="closeMapPopup" class="close-btn">‚úï</button>
        </div>
        <div class="popup-content">
            <div id="mapContainer"></div>
        </div>
        <div class="popup-footer">
            <span id="selectedAddress">–í—ã–±–µ—Ä–∏—Ç–µ —Ç–æ—á–∫—É –Ω–∞ –∫–∞—Ä—Ç–µ</span>
            <div>
                <button id="cancelMapSelection">–û—Ç–º–µ–Ω–∞</button>
                <button id="confirmMapSelection" disabled>–ü–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç—å</button>
            </div>
        </div>
    </div>
    
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <script src="app/static/js/map-integration.js"></script>
    
    <script>
        let testCount = 0;
        
        function updateStatus(message) {
            document.getElementById('status').textContent = `–°—Ç–∞—Ç—É—Å: ${message}`;
        }
        
        function testClick() {
            updateStatus('–ö–ª–∏–∫ –≤—ã–ø–æ–ª–Ω–µ–Ω - –∫–∞—Ä—Ç–∞ –Ω–µ –¥–æ–ª–∂–Ω–∞ –∑–∞–∫—Ä—ã—Ç—å—Å—è');
            console.log('Test click executed');
        }
        
        function testClickOutside() {
            updateStatus('–ö–ª–∏–∫ –≤–Ω–µ –∫–∞—Ä—Ç—ã –≤—ã–ø–æ–ª–Ω–µ–Ω - –∫–∞—Ä—Ç–∞ –¥–æ–ª–∂–Ω–∞ –∑–∞–∫—Ä—ã—Ç—å—Å—è');
            console.log('Test click outside executed');
        }
        
        function testMultipleOpens() {
            testCount++;
            updateStatus(`–¢–µ—Å—Ç ${testCount}: –û—Ç–∫—Ä—ã—Ç–∏–µ/–∑–∞–∫—Ä—ã—Ç–∏–µ –∫–∞—Ä—Ç—ã`);
            
            // –û—Ç–∫—Ä—ã–≤–∞–µ–º –∫–∞—Ä—Ç—É
            if (window.mapIntegration) {
                window.mapIntegration.openMap('testInput1');
                
                // –ß–µ—Ä–µ–∑ 2 —Å–µ–∫—É–Ω–¥—ã –∑–∞–∫—Ä—ã–≤–∞–µ–º
                setTimeout(() => {
                    window.mapIntegration.closeMap();
                    updateStatus(`–¢–µ—Å—Ç ${testCount}: –ö–∞—Ä—Ç–∞ –∑–∞–∫—Ä—ã—Ç–∞`);
                    
                    // –ß–µ—Ä–µ–∑ 1 —Å–µ–∫—É–Ω–¥—É –æ—Ç–∫—Ä—ã–≤–∞–µ–º —Å–Ω–æ–≤–∞
                    setTimeout(() => {
                        window.mapIntegration.openMap('testInput2');
                        updateStatus(`–¢–µ—Å—Ç ${testCount}: –ö–∞—Ä—Ç–∞ –æ—Ç–∫—Ä—ã—Ç–∞ —Å–Ω–æ–≤–∞`);
                        
                        // –ß–µ—Ä–µ–∑ 2 —Å–µ–∫—É–Ω–¥—ã –∑–∞–∫—Ä—ã–≤–∞–µ–º
                        setTimeout(() => {
                            window.mapIntegration.closeMap();
                            updateStatus(`–¢–µ—Å—Ç ${testCount}: –ó–∞–≤–µ—Ä—à–µ–Ω`);
                        }, 2000);
                    }, 1000);
                }, 2000);
            }
        }
        
        function checkConsole() {
            updateStatus('–ü—Ä–æ–≤–µ—Ä—å—Ç–µ –∫–æ–Ω—Å–æ–ª—å –±—Ä–∞—É–∑–µ—Ä–∞ –Ω–∞ –Ω–∞–ª–∏—á–∏–µ –æ—à–∏–±–æ–∫');
            console.log('=== –ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–æ–Ω—Å–æ–ª–∏ –Ω–∞ –æ—à–∏–±–∫–∏ ===');
            console.log('–ï—Å–ª–∏ –≤–∏–¥–∏—Ç–µ –æ—à–∏–±–∫–∏ "Map container is already initialized", —Ç–æ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è –Ω–µ —Ä–∞–±–æ—Ç–∞—é—Ç');
            console.log('–ï—Å–ª–∏ –æ—à–∏–±–æ–∫ –Ω–µ—Ç, —Ç–æ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è —Ä–∞–±–æ—Ç–∞—é—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ');
        }
        
        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø–æ—Å–ª–µ –∑–∞–≥—Ä—É–∑–∫–∏ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
        document.addEventListener('DOMContentLoaded', function() {
            updateStatus('–°—Ç—Ä–∞–Ω–∏—Ü–∞ –∑–∞–≥—Ä—É–∂–µ–Ω–∞, –∫–∞—Ä—Ç–∞ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–∞');
        });
    </script>
</body>
</html> 